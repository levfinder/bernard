{% extends 'dashboard/base.html' %}{% load i18n %}{% load l10n %}

{% block nav-route %}is-active{% endblock %}

{% block main %}
<div>
<div class="columns is-gapless" style="height: calc(100vh - 3.25rem);">
  <div class="column is-one-thirds media-items">
    <div class="section">
      <div class="content">
        <p><strong>Full route:</strong> {{ distance }}</p>
      </div>
      <div class="timeline">
        <header class="timeline-header">
          <span class="tag">Start</span>
        </header>

        {% for address in path %}
        <div class="timeline-item" id="{{ address.id }}">
          <div class="timeline-marker is-icon">
          {% if forloop.first or forloop.last %}
            <i class="fa fa-truck"></i>
          {% else %}
            <i class="fa fa-box"></i>
          {% endif %}
          </div>
          <div class="timeline-content">
            <p class="heading">{{ address.name }}</p>
            <p>{{ address }}</p>
          </div>
        </div>
        {% endfor %}

        <header class="timeline-header">
          <span class="tag">End</span>
        </header>
      </div>
    </div>
  </div>

  <div class="column is-two-thirds">
    <div id="map" style="height: 100%;"></div>
  </div>
</div>
</div>

{% localize off %}
<script>
var map;
var markers = {};

function initMap() {
  var bounds = new google.maps.LatLngBounds();
  var infowindow = new google.maps.InfoWindow();

  map = new google.maps.Map(document.getElementById('map'), {
    center: {lat: 57.6962992, lng: 11.9613259 },
    zoom: 12
  });

  var locations = {
  {% for address in path %}
  {{ address.id }}: { lat: {{ address.latitude }}, lng: {{ address.longitude }} },
  {% endfor %}
  };

  for (var key in locations) {
    var marker = new google.maps.Marker({position: locations[key], map: map});
    markers[key] = marker;
    bounds.extend(marker.position);
  }

  map.fitBounds(bounds);
}

function animateMarker(e) {
  markers[this.id].setAnimation(google.maps.Animation.BOUNCE);
}

function unAnimateMarker(e) {
  markers[this.id].setAnimation(null);
}

$('.timeline-item').hover(animateMarker, unAnimateMarker);

</script>

{% get_current_language as current_language %}

<script src="https://maps.googleapis.com/maps/api/js?key={{ googlemaps_key }}&callback=initMap&language={{ current_language }}" async defer></script>
{% endlocalize %}

{% endblock %}
